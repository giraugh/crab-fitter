pico-8 cartridge // http://www.pico-8.com
version 33
__lua__
crabs = {}
stars = {}
bubbles = {}
wlevel = 100
health = 3
invuln_cd = 0
score = 0
score_t = 0
game_over = false

fish = {
	x = 64,
	li = 1,
	y = wlevel + 12
}

function add_bubble(x,y)
	add(bubbles, {
		x = x,
		y = y
	})
end

function add_star(x,y)
	add(stars, {
		x = x,
		y = y,
		t = flr(rnd()*2)
	})
end

function add_crab(x,y)
	add(crabs, {
		x = x,
		y = y,
		vx = rnd() * 2,
		vy = 0,
	})
end

function _init()
 -- starting crab
	add_crab(10, 10)
	
	-- add some stars
	for i=1,15 do
		add_star(rnd()*128, rnd()*90)
	end
end

function _update()

	if game_over then
	 if btnp(‚ùé) or btnp(üÖæÔ∏è) then
	  score = 0
 		crabs = {}
 		fish.x = 64
 		health = 3
 		score = 0
 		score_t = 0
 		stars = {}
 		game_over = false
 		_init()
	 end
		return
	end
 
 -- add score
 score_t += 1
 if score_t > 30 then
 	score += 1
 	score_t = 0
 end
 if score > 15 and #crabs == 1 then
 	add_crab(-10, 0)
 end
 
	-- update fish
	if btn(‚û°Ô∏è) then
		fish.x += 3
		fish.li = 1
	end
	if btn(‚¨ÖÔ∏è) then
		fish.x -= 3
		fish.li = -1
	end
	
	-- make bubbles
	if rnd() < .08 then
		xx = fish.x + 10
		if fish.li == -1 then
			xx = fish.x - 1
		end
		add_bubble(
			xx,
			fish.y
		)
	end
	
	-- upd bubbles
	for b in all(bubbles) do
		b.y -= 1
		if b.y <= wlevel then
			del(bubbles, b)
		end
	end
	
	-- invuln coodown
	if invuln_cd > 0 then
		invuln_cd -= 1
	end

 -- update crabs
	for c in all(crabs) do
	
	 -- hit pl?
	 if invuln_cd == 0 then
		 dx = (c.x - fish.x) ^ 2
		 dy = (c.y - fish.y) ^ 2
		 dd = sqrt(dx + dy)
		 if dd < 10 then
		 	health -= 1
		 	invuln_cd = 40
		 	sfx(4)
		 	if health == 0 then
		 		game_over = true
		 	end
		 end
	 end
	
	 -- splash?
	 if c.y < wlevel then
	 	if c.y + c.vy > wlevel then
	 		sfx(0)
	 		sfx(3)
	 	end
	 end
	
	 -- apply vel
		c.x += c.vx
		c.y += c.vy
		
		-- apply grav
		c.vy += .6
		
		-- hit ground
		if c.y > wlevel then
			c.vy -= 3
			c.vx += .5*((rnd() * 2)-1)
		end
		if c.x > 110 then
			c.vx = -2
			sfx(2)
		end
		if c.x < 0 then
			c.vx = 2
			sfx(2)
		end
	end
end

function _draw()
 cls(0)
 
 -- draw moon
 spr(35, 10, 10, 2, 2)
 
 -- draw stars
 for s in all(stars) do
 	spr(1+s.t, s.x, s.y)
 end
 
 -- draw sea
 rectfill(0, wlevel+8, 128, 128, 1)
 for xx=-1,12 do
  of = flr(time()*3) % 16
 	spr(23, xx*16+of, wlevel, 2, 1)
 end
 spr(32, 16, 120)
 spr(48, 80, 120)
 spr(32, 105, 120)
 
 -- draw bubles
 for b in all(bubbles) do
 	spr(16, b.x, b.y)
 end
 
 -- draw crab
 for c in all(crabs) do
 	f = flr((time()*5) % 2) * 2
 	spr(3+f, c.x, c.y, 2, 2)
 	if c.y > wlevel then
 		for xx=c.x,c.x+16 do
 			for yy=c.y,c.y+16 do
 				if pget(xx,yy) == 9 then
 					pset(xx, yy, 12)
 				end
 				if pget(xx, yy) == 4 then
 					pset(xx, yy, 12)
 				end
 			end
 		end
 	end
 end
 
 -- draw fish
 if not game_over then
	 if invuln_cd % 2 == 0 then
			f = flr((time()*4) % 2) * 2
			f2 = flr((time()) % 2) * 2
		 s = 17
		 if f == 0 then
		 	s = 33
		 end
		 spr(s, fish.x, fish.y+f2, 2, 1, fish.li==-1)
		end
	end
	
	-- draw gui
	for i=1,max(0,health) do
		spr(49, 127-10*i, 1)
	end
	
	-- draw gameover
	if game_over then
	 w = 60
	 h = 26
	 rect(64-w/2-1, 64-h/2-1, 64+w/2+1, 64+h/2+1, 7)
		rectfill(64-w/2, 64-h/2, 64+w/2, 64+h/2, 0)
		print('game over', 47, 57, 7)
		print('time: ' .. score, 51, 66, 7)
	 f = flr((time()*4) % 2)
	 c = 7
	 if f == 0 then c = 6 end
	 print('‚ùé/üÖæÔ∏è', 75, 81, c)
	end
end
__gfx__
00000000000000000000000000000000000000000000000000000000111111111111111100000000000000000000000000000000000000000000000000000000
00000000000000000000060000009990099900000009990000999000111111111111111100000000000000000000000000000000000000000000000000000000
00700700000000000000666000099400009990000099400000099900111111111111111100000000000000000000000000000000000000000000000000000000
00077000000600000000060000090000000090000090000000000900111111111111111100000000000000000000000000000000000000000000000000000000
00077000006060000000000000090000000090000090000000000900111111111111111100000000000000000000000000000000000000000000000000000000
00700700000600000000000000004099990400000004009999004000111111111111111100000000000000000000000000000000000000000000000000000000
00000000000000000000000000004999999400000000499999940000111111111111111100000000000000000000000000000000000000000000000000000000
00000000000000000000000009004999999400900900499999940090111111111111111100000000000000000000000000000000000000000000000000000000
00000000000000288888000000999999999949000099999999994900000000000000000000000000000000000000000000000000000000000000000000000000
000000000882028888888000000004999940000000000499994000000000cc000000000000000000000000000000000000000000000000000000000000000000
0077000008888888888888000009409999049000009940999904990000cc11cc0000000000000000000000000000000000000000000000000000000000000000
07007000028888888872888000900049940009000900004994000090cc111111cc00000000000000000000000000000000000000000000000000000000000000
070070000088888888228880000004000040000000009400004900001111111111cc00cc00000000000000000000000000000000000000000000000000000000
00770000028888888888880000000900009000000009000000009000111111111111cc1100000000000000000000000000000000000000000000000000000000
00000000088202288888800000009000000900000000000000000000111111111111111100000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000111111111111111100000000000000000000000000000000000000000000000000000000
00000000000000288888000000006666677700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000888202888888800000666666777777000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000888888888888880006666666666777700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
03000000028888888872888006666666666677700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00300000008888888822888067666667666677770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
03000000288888888888880067777777666777770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00300030888202288888800067777776677777760000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
03000300000000000000000067766766667777660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000088008800000000067766676667667760000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000888888880000000067666677776667770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000888888880000000067766776776667770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000888888880000000066777766677677770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000888888880000000006777766677777700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00030000088888800000000006677777777777700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00300030008888000000000000666777777777000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00030030000880000000000000006666667700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1718171817181718171817181718171817180000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0707070707070707070707070707070707070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0707070707070707070707070707070707070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1110111011101100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000101100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000101100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100010001000100010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1110111011101110110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100010001000100010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1110111011101110110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0001000100010001000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1718171817181718171800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
001a00000f62006610006100060028600206001e6001a600146000f6000d600096000760003600056000360002600016000060000600036000360002600016000160001600000000000000000000000000000000
001a00000a63005620006100061000600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000b00000e01000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000302005000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000a00000525004210000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
